{% extends 'base.html' %}

{% block title %}Orders Management - Dairy Management System{% endblock %}

{% block content %}
<h1>Orders Management</h1>

{% if orders %}
<table class="table" style="margin-top: 1.5rem;">
    <thead>
        <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Email</th>
            <th>Amount</th>
            <th>Items</th>
            <th>Status</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for order in orders %}
        <tr>
            <td>#{{ order.id }}</td>
            <td>{{ order.user.username }}</td>
            <td>{{ order.user.email }}</td>
            <td>₹{{ order.total_amount }}</td>
            <td>{{ order.order_items|length }}</td>
            <td>
                <form method="POST" action="{{ url_for('update_order_status', order_id=order.id) }}" style="display: inline; margin: 0;">
                    <select name="status" onchange="this.form.submit()" style="padding: 0.25rem 0.5rem;">
                        <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                        <option value="Completed" {% if order.status == 'Completed' %}selected{% endif %}>Completed</option>
                        <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                    </select>
                </form>
            </td>
            <td>{{ order.order_date.strftime('%d-%m-%Y %H:%M') }}</td>
            <td>
                <details>
                    <summary style="cursor: pointer; color: #667eea;">View Details</summary>
                    <table class="table" style="margin-top: 0.5rem; width: 100%;">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Qty</th>
                                <th>Price</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in order.order_items %}
                            <tr>
                                <td>{{ item.product.name }}</td>
                                <td>{{ item.quantity }} {{ item.product.unit }}</td>
                                <td>₹{{ item.subtotal }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </details>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="card" style="text-align: center; margin-top: 2rem;">
    <p>No orders yet.</p>
</div>
{% endif %}
{% endblock %}
